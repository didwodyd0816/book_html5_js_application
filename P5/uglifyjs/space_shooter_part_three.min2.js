var game=new Game;function init(){if(game.init())game.start()}var imageRepository=new function(){this.background=new Image;this.spaceship=new Image;this.bullet=new Image;this.enemy=new Image;this.enemyBullet=new Image;var t=5;var i=0;function e(){i++;if(i===t){window.init()}}this.background.onload=function(){e()};this.spaceship.onload=function(){e()};this.bullet.onload=function(){e()};this.enemy.onload=function(){e()};this.enemyBullet.onload=function(){e()};this.background.src="imgs/bg.png";this.spaceship.src="imgs/ship.png";this.bullet.src="imgs/bullet.png";this.enemy.src="imgs/enemy.png";this.enemyBullet.src="imgs/bullet_enemy.png"};function Drawable(){this.init=function(t,i,e,s){this.x=t;this.y=i;this.width=e;this.height=s};this.speed=0;this.canvasWidth=0;this.canvasHeight=0;this.draw=function(){};this.move=function(){}}function Background(){this.speed=1;this.draw=function(){this.y+=this.speed;this.context.drawImage(imageRepository.background,this.x,this.y);this.context.drawImage(imageRepository.background,this.x,this.y-this.canvasHeight);if(this.y>=this.canvasHeight)this.y=0}}Background.prototype=new Drawable;function Bullet(t){this.alive=false;var i=t;this.spawn=function(t,i,e){this.x=t;this.y=i;this.speed=e;this.alive=true};this.draw=function(){this.context.clearRect(this.x-1,this.y-1,this.width+1,this.height+1);this.y-=this.speed;if(i==="bullet"&&this.y<=0-this.height){return true}else if(i==="enemyBullet"&&this.y>=this.canvasHeight){return true}else{if(i==="bullet"){this.context.drawImage(imageRepository.bullet,this.x,this.y)}else if(i==="enemyBullet"){this.context.drawImage(imageRepository.enemyBullet,this.x,this.y)}return false}};this.clear=function(){this.x=0;this.y=0;this.speed=0;this.alive=false}}Bullet.prototype=new Drawable;function Pool(t){var i=t;var e=[];this.init=function(t){if(t=="bullet"){for(var s=0;s<i;s++){var h=new Bullet("bullet");h.init(0,0,imageRepository.bullet.width,imageRepository.bullet.height);e[s]=h}}else if(t=="enemy"){for(var s=0;s<i;s++){var n=new Enemy;n.init(0,0,imageRepository.enemy.width,imageRepository.enemy.height);e[s]=n}}else if(t=="enemyBullet"){for(var s=0;s<i;s++){var h=new Bullet("enemyBullet");h.init(0,0,imageRepository.enemyBullet.width,imageRepository.enemyBullet.height);e[s]=h}}};this.get=function(t,s,h){if(!e[i-1].alive){e[i-1].spawn(t,s,h);e.unshift(e.pop())}};this.getTwo=function(t,s,h,n,a,o){if(!e[i-1].alive&&!e[i-2].alive){this.get(t,s,h);this.get(n,a,o)}};this.animate=function(){for(var t=0;t<i;t++){if(e[t].alive){if(e[t].draw()){e[t].clear();e.push(e.splice(t,1)[0])}}else break}}}function Ship(){this.speed=3;this.bulletPool=new Pool(30);this.bulletPool.init("bullet");var t=15;var i=0;this.draw=function(){this.context.drawImage(imageRepository.spaceship,this.x,this.y)};this.move=function(){i++;if(KEY_STATUS.left||KEY_STATUS.right||KEY_STATUS.down||KEY_STATUS.up){this.context.clearRect(this.x,this.y,this.width,this.height);if(KEY_STATUS.left){this.x-=this.speed;if(this.x<=0)this.x=0}else if(KEY_STATUS.right){this.x+=this.speed;if(this.x>=this.canvasWidth-this.width)this.x=this.canvasWidth-this.width}else if(KEY_STATUS.up){this.y-=this.speed;if(this.y<=this.canvasHeight/4*3)this.y=this.canvasHeight/4*3}else if(KEY_STATUS.down){this.y+=this.speed;if(this.y>=this.canvasHeight-this.height)this.y=this.canvasHeight-this.height}this.draw()}if(KEY_STATUS.space&&i>=t){this.fire();i=0}};this.fire=function(){this.bulletPool.getTwo(this.x+6,this.y,3,this.x+33,this.y,3)}}Ship.prototype=new Drawable;function Enemy(){var t=.01;var i=0;this.alive=false;this.spawn=function(t,i,e){this.x=t;this.y=i;this.speed=e;this.speedX=0;this.speedY=e;this.alive=true;this.leftEdge=this.x-90;this.rightEdge=this.x+90;this.bottomEdge=this.y+140};this.draw=function(){this.context.clearRect(this.x-1,this.y,this.width+1,this.height);this.x+=this.speedX;this.y+=this.speedY;if(this.x<=this.leftEdge){this.speedX=this.speed}else if(this.x>=this.rightEdge+this.width){this.speedX=-this.speed}else if(this.y>=this.bottomEdge){this.speed=1.5;this.speedY=0;this.y-=5;this.speedX=-this.speed}this.context.drawImage(imageRepository.enemy,this.x,this.y);i=Math.floor(Math.random()*101);if(i/100<t){this.fire()}};this.fire=function(){game.enemyBulletPool.get(this.x+this.width/2,this.y+this.height,-2.5)};this.clear=function(){this.x=0;this.y=0;this.speed=0;this.speedX=0;this.speedY=0;this.alive=false}}Enemy.prototype=new Drawable;function Game(){this.init=function(){this.bgCanvas=document.getElementById("background");this.shipCanvas=document.getElementById("ship");this.mainCanvas=document.getElementById("main");if(this.bgCanvas.getContext){this.bgContext=this.bgCanvas.getContext("2d");this.shipContext=this.shipCanvas.getContext("2d");this.mainContext=this.mainCanvas.getContext("2d");Background.prototype.context=this.bgContext;Background.prototype.canvasWidth=this.bgCanvas.width;Background.prototype.canvasHeight=this.bgCanvas.height;Ship.prototype.context=this.shipContext;Ship.prototype.canvasWidth=this.shipCanvas.width;Ship.prototype.canvasHeight=this.shipCanvas.height;Bullet.prototype.context=this.mainContext;Bullet.prototype.canvasWidth=this.mainCanvas.width;Bullet.prototype.canvasHeight=this.mainCanvas.height;Enemy.prototype.context=this.mainContext;Enemy.prototype.canvasWidth=this.mainCanvas.width;Enemy.prototype.canvasHeight=this.mainCanvas.height;this.background=new Background;this.background.init(0,0);this.ship=new Ship;var t=this.shipCanvas.width/2-imageRepository.spaceship.width;var i=this.shipCanvas.height/4*3+imageRepository.spaceship.height*2;this.ship.init(t,i,imageRepository.spaceship.width,imageRepository.spaceship.height);this.enemyPool=new Pool(30);this.enemyPool.init("enemy");var e=imageRepository.enemy.height;var s=imageRepository.enemy.width;var h=100;var n=-e;var a=n*1.5;for(var o=1;o<=18;o++){this.enemyPool.get(h,n,2);h+=s+25;if(o%6==0){h=100;n+=a}}this.enemyBulletPool=new Pool(50);this.enemyBulletPool.init("enemyBullet");return true}else{return false}};this.start=function(){this.ship.draw();animate()}}function animate(){requestAnimFrame(animate);game.background.draw();game.ship.move();game.ship.bulletPool.animate();game.enemyPool.animate();game.enemyBulletPool.animate()}KEY_CODES={32:"space",37:"left",38:"up",39:"right",40:"down"};KEY_STATUS={};for(code in KEY_CODES){KEY_STATUS[KEY_CODES[code]]=false}document.onkeydown=function(t){var i=t.keyCode?t.keyCode:t.charCode;if(KEY_CODES[i]){t.preventDefault();KEY_STATUS[KEY_CODES[i]]=true}};document.onkeyup=function(t){var i=t.keyCode?t.keyCode:t.charCode;if(KEY_CODES[i]){t.preventDefault();KEY_STATUS[KEY_CODES[i]]=false}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){window.setTimeout(t,1e3/60)}}();